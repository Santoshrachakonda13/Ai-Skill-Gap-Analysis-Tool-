# AI Skill Gap Analysis Tool - Makefile

.PHONY: build run test lint clean sbom

# Build all Docker images
build:
	docker-compose build

# Run the entire system
run:
	docker-compose up -d

# Stop all services
stop:
	docker-compose down

# Run tests
test:
	docker-compose exec api-gateway pytest tests/ -v
	docker-compose exec knowledge-mapping pytest tests/ -v
	docker-compose exec curriculum-generator pytest tests/ -v
	docker-compose exec progress-tracker pytest tests/ -v

# Lint code
lint:
	docker-compose exec api-gateway flake8 app/
	docker-compose exec knowledge-mapping flake8 app/

# Database migrations
migrate:
	docker-compose exec api-gateway python -m alembic upgrade head

# Generate SBOM (Software Bill of Materials)
sbom:
	docker sbom api-gateway > sbom-api-gateway.json
	docker sbom knowledge-mapping > sbom-knowledge-mapping.json

# Clean up containers and volumes
clean:
	docker-compose down -v
	docker system prune -f

# Load test
load-test:
	docker run --rm -i grafana/k6 run --vus 100 --duration 30s - <tests/load/api_test.js

# Security scan
security-scan:
	docker scout cves api-gateway
	docker scout cves knowledge-mapping

# Full deployment
deploy: build test security-scan
	./scripts/deploy.sh production

# Development setup
dev-setup:
	cp .env.example .env
	docker-compose up -d postgres redis
	sleep 10
	make migrate
	echo "Development environment ready!"
